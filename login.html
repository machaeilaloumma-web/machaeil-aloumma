<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙÙ‚Ø· ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ø¹Ù„Ø§Ø¬ Ø®Ø·Ø£ unsafe-eval Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ -->
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline' https://www.gstatic.com https://www.googleapis.com https://www.google.com https://apis.google.com https://www.gstatic.com/firebasejs/; connect-src 'self' https://firestore.googleapis.com https://www.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; object-src 'none';">

  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù…Ø´Ø§Ø¹Ù„ Ø§Ù„Ø£Ù…Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Ù„Ø§ ØªØºÙŠÙŠØ± ÙÙŠ CSS */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Kufi Arabic', sans-serif; }
    body { background: #000; color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow-x: hidden; }
    .logo { width: 250px; height: 250px; margin-bottom: 16px; }
    .login-container { background: #1a1a25; padding: 20px; border-radius: 16px; width: 90%; max-width: 420px; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
    h1 { color: #fff; margin-bottom: 16px; font-size: 24px; text-align: center; text-shadow: 0 0 10px rgba(0, 255, 128, 0.25); }
    .form-group { margin-bottom: 12px; position: relative; }
    label { display: block; margin-bottom: 4px; font-weight: 500; text-align: right; color: #aaa; font-size: 14px; position: absolute; top: 11px; right: 50px; pointer-events: none; z-index: 2; transition: all 0.2s; }
    input { width: 100%; padding: 10px 14px; background: #252535; border: 1px solid #2e2e3d; border-radius: 8px; color: white; outline: none; font-size: 16px; padding-right: 56px; }
    input:focus { border-color: #00ff80; box-shadow: 0 0 12px rgba(0,255,128,0.3); }
    input:not(:placeholder-shown) + label, input:focus + label { top: -10px; right: 14px; font-size: 12px; color: #00ff80; background: #1a1a25; padding: 0 5px; border-radius: 4px; }
    .input-with-icon { position: relative; display: flex; align-items: center; }
    .input-with-icon .icon { position: absolute; left: 14px; color: #00ff80; pointer-events: none; z-index: 1; }
    .input-with-icon input { padding-left: 44px; }
    .password-field { position: relative; }
    .password-field input { padding-right: 56px; padding-bottom: 12px; }
    .toggle-password { 
      position: absolute; 
      right: 14px; 
      bottom: 10px; 
      cursor: pointer; 
      color: #aaa; 
      font-size: 18px; 
      z-index: 10; 
      pointer-events: auto; 
      user-select: none;
    }
    .password-input { background: #e0e0e0 !important; color: #000; }
    button#loginBtn { width: 100%; padding: 10px; background: #252535; color: #fff; font-weight: 500; border: 1px solid #2e2e3d; border-radius: 8px; cursor: pointer; margin-top: 6px; font-size: 16px; transition: all 0.3s ease; }
    button#loginBtn:hover { border-color: #00ff80; box-shadow: 0 0 12px rgba(0,255,128,0.3); transform: translateY(-2px); }
    .register-link { text-align: center; margin-top: 12px; font-size: 14px; }
    .register-link a { color: #00ff80; text-decoration: none; transition: opacity 0.3s; }
    .register-link a:hover { opacity: 0.8; text-decoration: underline; }
  </style>
</head>
<body>
  <div class="login-container">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
    <form id="loginForm">
      <div class="form-group">
        <div class="input-with-icon">
          <span class="icon">âœ‰ï¸</span>
          <input type="email" id="email" required placeholder=" " />
          <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        </div>
      </div>

      <!-- ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø®Ø§Ø±Ø¬ input-with-icon Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„ -->
      <div class="form-group password-field">
        <div class="input-with-icon">
          <span class="icon">ğŸ”’</span>
          <input type="password" id="password" class="password-input" required minlength="6" placeholder=" " />
          <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        </div>
        <span class="toggle-password" onclick="togglePassword('password')">ğŸ‘ï¸</span>
      </div>

      <!-- Ù„Ø§ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© "Ø¯Ø®ÙˆÙ„" -->
      <button type="button" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
    </form>

    <div class="register-link">
      Ù„Ø§ ØªÙ…Ù„Ùƒ Ø­Ø³Ø§Ø¨ØŸ <a href="register.html">Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø§Ù„Ø¢Ù†</a>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDiypCTp31wIc5MR3FhClKobeQTeK-vaFs",
      authDomain: "machaeil-aloumma.firebaseapp.com",
      projectId: "machaeil-aloumma",
      storageBucket: "machaeil-aloumma.firebasestorage.app",
      messagingSenderId: "678363443395",
      appId: "1:678363443395:web:b604b002d4e8fd430d3276"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    window.togglePassword = function(fieldId) {
      const field = document.getElementById(fieldId);
      if (field) {
        field.type = field.type === "password" ? "text" : "password";
        // ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        const toggle = document.querySelector('.toggle-password');
        toggle.textContent = field.type === "password" ? "ğŸ™ˆ" : "ğŸ‘ï¸";
      }
    };

    document.getElementById('loginForm').addEventListener('submit', (ev) => ev.preventDefault());

    document.getElementById('loginBtn').addEventListener('click', async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!email || !password) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.');
        return;
      }

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        console.log("ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­:", user.uid);

        const userDocRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userDocRef);

        if (userSnap.exists()) {
          const userData = userSnap.data();
          localStorage.setItem("user", JSON.stringify(userData));
          window.location.href = "profile.html";
        } else {
          console.warn("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore.");
          localStorage.setItem("user", JSON.stringify({ email: user.email }));
          window.location.href = "profile.html";
        }

      } catch (error) {
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error.code, error.message);
        if (error.code === "auth/user-not-found" || error.code === "auth/wrong-password") {
          alert("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
        } else {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        }
      }
    });
  </script>
</body>
</html>








